# æœåŠ¡å™¨éƒ¨ç½²å‘½ä»¤ - ç®€åŒ–ç‰ˆ

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

### æ­¥éª¤ 1ï¼šè¿›å…¥é¡¹ç›®ç›®å½•å¹¶æ‹‰å–ä»£ç 

```bash
cd /root/crm
git pull origin main
```

### æ­¥éª¤ 2ï¼šæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

```bash
# æŸ¥æ‰¾è™šæ‹Ÿç¯å¢ƒç›®å½•
ls -la | grep -E "venv|env|virtualenv"

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆæ ¹æ®å®é™…ç›®å½•åé€‰æ‹©ï¼‰
source venv/bin/activate
# æˆ–
source env/bin/activate
# æˆ–
source .venv/bin/activate
```

**ç¡®è®¤è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»**ï¼š
- å‘½ä»¤è¡Œå‰é¢åº”è¯¥æ˜¾ç¤º `(venv)` æˆ– `(env)`
- è¿è¡Œ `which python` åº”è¯¥æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒä¸­çš„ Python è·¯å¾„

### æ­¥éª¤ 3ï¼šè¿è¡Œæ•°æ®åº“è¿ç§»

```bash
python add_user_id_to_communications.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
=== å¼€å§‹æ•°æ®åº“è¿ç§»ï¼šæ·»åŠ  user_id å­—æ®µåˆ° communication_records è¡¨ ===

æ­£åœ¨æ·»åŠ  user_id å­—æ®µ...
âœ… user_id å­—æ®µæ·»åŠ æˆåŠŸ

=== è¿ç§»å®Œæˆ ===
```

æˆ–è€…ï¼ˆå¦‚æœå­—æ®µå·²å­˜åœ¨ï¼‰ï¼š
```
=== å¼€å§‹æ•°æ®åº“è¿ç§»ï¼šæ·»åŠ  user_id å­—æ®µåˆ° communication_records è¡¨ ===

âœ… user_id å­—æ®µå·²å­˜åœ¨ï¼Œæ— éœ€æ·»åŠ 

=== è¿ç§»å®Œæˆ ===
```

### æ­¥éª¤ 4ï¼šé‡å¯æœåŠ¡

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ systemd
sudo systemctl restart crm

# æ–¹æ³• 2ï¼šä½¿ç”¨ supervisor
sudo supervisorctl restart crm

# æ–¹æ³• 3ï¼šæ‰‹åŠ¨é‡å¯
pkill -f "python.*run.py"
nohup python run.py > logs/app.log 2>&1 &
```

### æ­¥éª¤ 5ï¼šé…ç½®è‡ªåŠ¨å¤‡ä»½

```bash
# ç¡®ä¿ä»åœ¨è™šæ‹Ÿç¯å¢ƒä¸­
bash setup_backup_cron.sh
```

æŒ‰æç¤ºæ“ä½œï¼š
1. çœ‹åˆ° "æ˜¯å¦ç«‹å³è¿è¡Œä¸€æ¬¡å¤‡ä»½æµ‹è¯•ï¼Ÿ[Y/n]" æ—¶ï¼Œè¾“å…¥ `y`
2. ç¡®è®¤å¤‡ä»½æˆåŠŸ

### æ­¥éª¤ 6ï¼šéªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥å¤‡ä»½ç›®å½•
ls -lh bak/

# 2. æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail -20 bak/backup.log

# 3. æŸ¥çœ‹ cron ä»»åŠ¡
crontab -l

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status crm
# æˆ–
sudo supervisorctl status crm
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ°è™šæ‹Ÿç¯å¢ƒ

```bash
# åœ¨é¡¹ç›®ç›®å½•ä¸‹æŸ¥æ‰¾
find . -name "activate" -type f

# å¦‚æœæ‰¾åˆ°ï¼Œæ¿€æ´»å®ƒ
source ./path/to/venv/bin/activate
```

### é—®é¢˜ 2ï¼šModuleNotFoundError: No module named 'flask'

**åŸå› **ï¼šè™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»

**è§£å†³**ï¼š
```bash
# 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# 2. ç¡®è®¤ Python è·¯å¾„
which python
# åº”è¯¥æ˜¾ç¤ºï¼š/root/crm/venv/bin/python

# 3. é‡æ–°è¿è¡Œè¿ç§»
python add_user_id_to_communications.py
```

### é—®é¢˜ 3ï¼šæ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨

```bash
# æŸ¥æ‰¾æ•°æ®åº“æ–‡ä»¶
find . -name "*.db" -type f

# åº”è¯¥æ‰¾åˆ°ï¼š./instance/edu_crm.db
```

### é—®é¢˜ 4ï¼šæƒé™ä¸è¶³

```bash
# è®¾ç½®è„šæœ¬æ‰§è¡Œæƒé™
chmod +x *.sh

# è®¾ç½®æ•°æ®åº“æ–‡ä»¶æƒé™
chmod 644 instance/edu_crm.db
```

---

## ğŸ“‹ å®Œæ•´çš„ä¸€é”®å‘½ä»¤ï¼ˆå¤åˆ¶ç²˜è´´ï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/crm

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ï¼‰
source venv/bin/activate

# è¿è¡Œæ•°æ®åº“è¿ç§»
python add_user_id_to_communications.py

# é‡å¯æœåŠ¡ï¼ˆæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ï¼‰
sudo systemctl restart crm

# é…ç½®è‡ªåŠ¨å¤‡ä»½
bash setup_backup_cron.sh

# éªŒè¯éƒ¨ç½²
echo "=== æ£€æŸ¥å¤‡ä»½ç›®å½• ==="
ls -lh bak/

echo "=== æ£€æŸ¥ cron ä»»åŠ¡ ==="
crontab -l

echo "=== æ£€æŸ¥æœåŠ¡çŠ¶æ€ ==="
sudo systemctl status crm
```

---

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

### æ•°æ®åº“è¿ç§»éªŒè¯
- [ ] è®¿é—® http://47.100.238.50
- [ ] ç™»å½•è´¦å·ï¼š13900139001
- [ ] è¿›å…¥çº¿ç´¢åˆ—è¡¨é¡µ
- [ ] ç‚¹å‡»ä»»æ„å­¦å‘˜å§“å
- [ ] ç¡®è®¤å­¦å‘˜è¯¦æƒ…å¼¹çª—æ­£å¸¸æ˜¾ç¤ºï¼ˆæ—  JSON é”™è¯¯ï¼‰
- [ ] ç‚¹å‡»"æ–°å¢æ²Ÿé€šè®°å½•"
- [ ] å¡«å†™å†…å®¹å¹¶ä¿å­˜
- [ ] ç¡®è®¤æ˜¾ç¤ºå¡«å†™äººä¿¡æ¯ï¼ˆå¦‚ï¼šKingbleè€å¸ˆï¼‰

### è‡ªåŠ¨å¤‡ä»½éªŒè¯
- [ ] è¿è¡Œ `crontab -l` çœ‹åˆ°å¤‡ä»½ä»»åŠ¡
- [ ] è¿è¡Œ `ls -lh bak/` çœ‹åˆ°å¤‡ä»½æ–‡ä»¶
- [ ] è¿è¡Œ `tail -20 bak/backup.log` çœ‹åˆ°å¤‡ä»½æ—¥å¿—
- [ ] å¤‡ä»½æ–‡ä»¶æ ¼å¼ï¼š`edu_crm_YYYYMMDD_HHMMSS.db`

---

**æœåŠ¡å™¨**ï¼š47.100.238.50  
**é¡¹ç›®è·¯å¾„**ï¼š/root/crm  
**æ•°æ®åº“æ–‡ä»¶**ï¼šinstance/edu_crm.db  
**å¤‡ä»½ç›®å½•**ï¼šbak/

