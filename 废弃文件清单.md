# 废弃文件清单

本文档列出项目中已经不再使用的文件，可以安全删除。

---

## 📋 废弃文件分类

### 一、已废弃的迁移脚本（6个）

这些脚本的功能已被 `migrate_database.py` 统一替代：

#### 1. `add_user_id_to_communications.py` ❌
- **原用途**: 为 communication_records 表添加 user_id 字段
- **废弃原因**: 该迁移已在早期完成，不再需要
- **替代方案**: 无需替代，功能已完成

#### 2. `migrations/add_teachers_table.py` ❌
- **原用途**: 创建 teachers 表和添加 customers.teacher_id 字段
- **废弃原因**: 已被 `migrate_database.py` 中的 `migrate_add_teachers_table()` 替代
- **替代方案**: 使用 `migrate_database.py`

#### 3. `migrations/add_teacher_images_table.py` ❌
- **原用途**: 创建 teacher_images 表
- **废弃原因**: 已被 `migrate_database.py` 统一处理
- **替代方案**: 使用 `migrate_database.py`

#### 4. `migrations/migrate_teacher_to_supervisor.py` ❌
- **原用途**: 将 teacher 角色更新为 teacher_supervisor
- **废弃原因**: 已被 `migrate_database.py` 中的 `migrate_update_user_roles()` 替代
- **替代方案**: 使用 `migrate_database.py`

#### 5. `update_roles.py` ❌
- **原用途**: 独立的角色更新工具
- **废弃原因**: 已被 `migrate_database.py` 集成
- **替代方案**: 使用 `migrate_database.py`

#### 6. `verify_migration.py` ❌
- **原用途**: 验证角色迁移结果
- **废弃原因**: 迁移已完成，不再需要验证
- **替代方案**: 无需替代

---

### 二、已废弃的测试脚本（3个）

#### 1. `test_role_migration.py` ❌
- **原用途**: 测试角色迁移功能
- **废弃原因**: 角色迁移已完成并验证通过
- **替代方案**: 无需替代

#### 2. `test_teachers.py` ❌
- **原用途**: 测试老师管理功能
- **废弃原因**: 功能已上线并稳定运行
- **替代方案**: 无需替代

#### 3. `test_data_export.py` ❌
- **原用途**: 测试数据下载功能
- **废弃原因**: 功能已上线并验证通过
- **替代方案**: 无需替代

---

### 三、已废弃的部署脚本（1个）

#### 1. `deploy_migration.sh` ❌
- **原用途**: 部署数据库迁移（旧版）
- **废弃原因**: 已被 `deploy_update.sh` 替代
- **替代方案**: 使用 `deploy_update.sh`

---

### 四、已废弃的文档（9个）

#### 1. `部署指南-数据库迁移.md` ❌
- **原用途**: 旧版数据库迁移指南
- **废弃原因**: 已被 `服务器部署指南.md` 替代
- **替代方案**: 查看 `服务器部署指南.md`

#### 2. `服务器部署命令-简化版.md` ❌
- **原用途**: 简化版部署命令
- **废弃原因**: 已被 `服务器部署指南.md` 替代
- **替代方案**: 查看 `服务器部署指南.md`

#### 3. `服务器部署完整指南.md` ❌
- **原用途**: 旧版完整部署指南
- **废弃原因**: 已被 `服务器部署指南.md` 替代
- **替代方案**: 查看 `服务器部署指南.md`

#### 4. `沟通记录填写人功能说明.md` ❌
- **原用途**: 沟通记录功能说明
- **废弃原因**: 功能已稳定，文档已过时
- **替代方案**: 无需替代

#### 5. `数据下载功能说明.md` ❌
- **原用途**: 数据下载功能说明
- **废弃原因**: 功能已上线，文档已过时
- **替代方案**: 无需替代

#### 6. `千位分隔符应用说明.md` ❌
- **原用途**: 千位分隔符功能说明
- **废弃原因**: 功能已稳定，文档已过时
- **替代方案**: 无需替代

#### 7. `清理文件列表.md` ❌
- **原用途**: 旧版清理文件列表
- **废弃原因**: 已被本文档替代
- **替代方案**: 查看本文档

#### 8. `项目清理总结.md` ❌
- **原用途**: 旧版项目清理总结
- **废弃原因**: 信息已过时
- **替代方案**: 无需替代

#### 9. `老师角色.md` ❌
- **原用途**: 空文件
- **废弃原因**: 无内容
- **替代方案**: 无需替代

---

### 五、已废弃的工具脚本（1个）

#### 1. `cleanup.sh` ❌
- **原用途**: 旧版文件清理脚本
- **废弃原因**: 清理任务已完成
- **替代方案**: 无需替代

---

### 六、已废弃的路由（2个）

这些路由在 `run.py` 中定义，但已不再使用：

#### 1. `/test-ajax` 路由 ❌
- **位置**: `run.py` 第 380-387 行
- **原用途**: 测试 AJAX 功能
- **废弃原因**: 测试已完成
- **替代方案**: 删除该路由

#### 2. `/migrate-communication-records` 路由 ❌
- **位置**: `run.py` 第 389-445 行
- **原用途**: 迁移数据到统一沟通记录表
- **废弃原因**: 迁移已完成
- **替代方案**: 删除该路由

---

## 🗑️ 删除命令

### 安全删除所有废弃文件

```bash
# 进入项目目录
cd /path/to/CRM1

# 删除废弃的迁移脚本
rm -f add_user_id_to_communications.py
rm -f update_roles.py
rm -f verify_migration.py
rm -rf migrations/

# 删除废弃的测试脚本
rm -f test_role_migration.py
rm -f test_teachers.py
rm -f test_data_export.py

# 删除废弃的部署脚本
rm -f deploy_migration.sh

# 删除废弃的文档
rm -f 部署指南-数据库迁移.md
rm -f 服务器部署命令-简化版.md
rm -f 服务器部署完整指南.md
rm -f 沟通记录填写人功能说明.md
rm -f 数据下载功能说明.md
rm -f 千位分隔符应用说明.md
rm -f 清理文件列表.md
rm -f 项目清理总结.md
rm -f 老师角色.md

# 删除废弃的工具脚本
rm -f cleanup.sh

# 删除其他废弃文件
rm -f 快速部署命令.txt
rm -f check_git_status.py
rm -f push-to-github.sh
rm -f push-to-github.ps1

# 确认删除
echo "✅ 废弃文件已删除"
```

---

## ✅ 保留的核心文件

### 应用核心（6个）
- ✅ `run.py` - 应用入口（需要删除废弃路由）
- ✅ `models.py` - 数据模型
- ✅ `config.py` - 配置文件
- ✅ `communication_utils.py` - 沟通记录工具（仍在使用）
- ✅ `gunicorn.conf.py` - Gunicorn 配置
- ✅ `requirements.txt` - 依赖列表

### 部署工具（3个）
- ✅ `deploy_update.sh` - 一键部署脚本
- ✅ `migrate_database.py` - 数据库迁移工具
- ✅ `backup_database.sh` - 数据库备份脚本
- ✅ `setup_backup_cron.sh` - 备份定时任务配置

### 数据完整性（1个）
- ✅ `fix_data_integrity.py` - 数据完整性检查工具

### 文档（4个）
- ✅ `README.md` - 项目说明
- ✅ `服务器部署指南.md` - 最新部署指南
- ✅ `数据库备份使用说明.md` - 备份说明
- ✅ `数据库结构说明.md` - 数据库文档
- ✅ `数据丢失隐患分析报告.md` - 数据安全分析
- ✅ `测试账号信息.md` - 测试账号

---

## 📝 需要修改的文件

### `run.py` 需要删除的代码

#### 删除 `/test-ajax` 路由（第 380-387 行）
```python
# ❌ 删除以下代码
@app.route('/test-ajax')
def test_ajax():
    """测试AJAX功能的页面"""
    try:
        with open('test_ajax_feedback.html', 'r', encoding='utf-8') as f:
            return f.read()
    except FileNotFoundError:
        return '测试页面文件不存在', 404
```

#### 删除 `/migrate-communication-records` 路由（第 389-445 行）
```python
# ❌ 删除以下代码
@app.route('/migrate-communication-records')
def migrate_communication_records():
    """迁移数据到统一沟通记录表"""
    # ... 整个函数体
```

---

## 📊 清理统计

### 文件数量统计
- **废弃迁移脚本**: 6个
- **废弃测试脚本**: 3个
- **废弃部署脚本**: 1个
- **废弃文档**: 9个
- **废弃工具脚本**: 1个
- **废弃路由**: 2个
- **其他废弃文件**: 3个

**总计**: 25个文件/代码段

### 清理后的效果
- ✅ 减少项目文件数量
- ✅ 避免混淆和误用
- ✅ 提高代码可维护性
- ✅ 简化部署流程

---

## ⚠️ 注意事项

1. **备份**: 删除前建议先提交当前代码到 Git
2. **验证**: 删除后运行测试确保功能正常
3. **文档**: 保留 `服务器部署指南.md` 作为唯一部署文档
4. **迁移**: 使用 `migrate_database.py` 作为唯一迁移工具

---

## 🚀 执行清理

### 步骤 1: 备份当前代码
```bash
git add -A
git commit -m "清理前备份"
git push origin master
```

### 步骤 2: 执行删除
```bash
# 复制上面的删除命令执行
```

### 步骤 3: 修改 run.py
```bash
# 手动编辑 run.py，删除废弃路由
```

### 步骤 4: 提交清理
```bash
git add -A
git commit -m "清理废弃文件：删除25个不再使用的文件和代码段"
git push origin master
```

---

**清理完成后，项目将更加简洁和易于维护！** 🎉

