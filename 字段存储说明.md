# å­—æ®µå­˜å‚¨è¯´æ˜æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æ›´æ–°æ—¶é—´**: 2025-09-30
**ç³»ç»Ÿ**: EduConnect CRM

> âš ï¸ **é‡è¦æ›´æ–°**: æ ¹æ®å®é™…ä¸šåŠ¡æµç¨‹ï¼Œ`competition_award_level` å’Œ `additional_requirements` å­—æ®µå·²æ¢å¤åˆ°çº¿ç´¢è¡¨ï¼Œé”€å”®å¯ä»¥åœ¨çº¿ç´¢é˜¶æ®µç›´æ¥è®¾ç½®è¿™äº›å­—æ®µã€‚

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†EduConnect CRMç³»ç»Ÿä¸­å„ä¸ªå…³é”®å­—æ®µçš„å­˜å‚¨æ–¹å¼ï¼ŒåŒ…æ‹¬æœåŠ¡ç±»å‹ã€ç«èµ›ç­‰çº§å’Œé¢å¤–è¦æ±‚ç­‰å­—æ®µã€‚

---

## ğŸ—‚ï¸ æ•°æ®è¡¨ç»“æ„

### çº¿ç´¢è¡¨ (leads)

**ç”¨é€”**: å­˜å‚¨é”€å”®é˜¶æ®µçš„çº¿ç´¢ä¿¡æ¯

**å…³é”®å­—æ®µ**:
- `service_types` - æœåŠ¡ç±»å‹ï¼ˆJSONæ ¼å¼ï¼‰
- `sales_user_id` - è´£ä»»é”€å”®ID
- `stage` - çº¿ç´¢é˜¶æ®µ
- `contract_amount` - åˆåŒé‡‘é¢

### å®¢æˆ·è¡¨ (customers)

**ç”¨é€”**: å­˜å‚¨äº¤ä»˜é˜¶æ®µçš„å®¢æˆ·ä¿¡æ¯

**å…³é”®å­—æ®µ**:
- `lead_id` - å…³è”çº¿ç´¢IDï¼ˆå¤–é”®ï¼‰
- `teacher_user_id` - è´£ä»»ç­ä¸»ä»»ID
- `competition_award_level` - ç«èµ›å¥–é¡¹ç­‰çº§
- `additional_requirements` - é¢å¤–è¦æ±‚
- `exam_year` - ä¸­è€ƒæˆ–é«˜è€ƒå¹´ä»½

---

## ğŸ“Š å­—æ®µè¯¦ç»†è¯´æ˜

### 1. æœåŠ¡ç±»å‹ (service_types)

#### å­˜å‚¨ä½ç½®
**è¡¨**: `leads` (çº¿ç´¢è¡¨)  
**å­—æ®µ**: `service_types`  
**ç±»å‹**: `TEXT`

#### å­˜å‚¨æ ¼å¼
**JSONå­—ç¬¦ä¸²æ•°ç»„**

```json
["tutoring", "competition", "upgrade_guidance"]
```

#### å¯é€‰å€¼
| å€¼ | ä¸­æ–‡åç§° | è¯´æ˜ |
|---|---------|------|
| `tutoring` | è¯¾é¢˜è¾…å¯¼ | ç§‘ç ”è¯¾é¢˜è¾…å¯¼æœåŠ¡ |
| `competition` | ç«èµ›è¾…å¯¼ | ç«èµ›å¥–é¡¹è¾…å¯¼æœåŠ¡ |
| `upgrade_guidance` | å‡å­¦é™ªè·‘ | å‡å­¦è§„åˆ’é™ªè·‘æœåŠ¡ |

#### å®é™…å­˜å‚¨ç¤ºä¾‹

**ç¤ºä¾‹1: å•ä¸ªæœåŠ¡**
```python
# æ•°æ®åº“å­˜å‚¨
service_types = '["tutoring"]'

# è§£æå
['tutoring']  # åªæœ‰è¯¾é¢˜è¾…å¯¼
```

**ç¤ºä¾‹2: å¤šä¸ªæœåŠ¡**
```python
# æ•°æ®åº“å­˜å‚¨
service_types = '["tutoring", "competition", "upgrade_guidance"]'

# è§£æå
['tutoring', 'competition', 'upgrade_guidance']  # ä¸‰ç§æœåŠ¡éƒ½æœ‰
```

**ç¤ºä¾‹3: ä¸¤ä¸ªæœåŠ¡**
```python
# æ•°æ®åº“å­˜å‚¨
service_types = '["tutoring", "competition"]'

# è§£æå
['tutoring', 'competition']  # è¯¾é¢˜è¾…å¯¼ + ç«èµ›è¾…å¯¼
```

#### è¯»å–æ–¹å¼

**æ–¹å¼1: ç›´æ¥è¯»å–ï¼ˆéœ€è¦æ‰‹åŠ¨è§£æJSONï¼‰**
```python
lead = Lead.query.get(1)
service_types_str = lead.service_types  # '["tutoring", "competition"]'

import json
service_list = json.loads(service_types_str)  # ['tutoring', 'competition']
```

**æ–¹å¼2: ä½¿ç”¨è¾…åŠ©æ–¹æ³•ï¼ˆæ¨èï¼‰**
```python
lead = Lead.query.get(1)
service_list = lead.get_service_types_list()  # ['tutoring', 'competition']
```

**æ–¹å¼3: ä»å®¢æˆ·è¡¨è¯»å–ï¼ˆé€šè¿‡å…³è”å…³ç³»ï¼‰**
```python
customer = Customer.query.get(1)
service_list = customer.get_service_types()  # ä»å…³è”çš„çº¿ç´¢è¡¨è¯»å–
```

#### è®¾ç½®æ–¹å¼

**æ–¹å¼1: ç›´æ¥è®¾ç½®JSONå­—ç¬¦ä¸²**
```python
import json
lead.service_types = json.dumps(['tutoring', 'competition'])
```

**æ–¹å¼2: ä½¿ç”¨è¾…åŠ©æ–¹æ³•ï¼ˆæ¨èï¼‰**
```python
lead.set_service_types_list(['tutoring', 'competition'])
```

#### æ£€æŸ¥æ˜¯å¦åŒ…å«æŸä¸ªæœåŠ¡

```python
lead = Lead.query.get(1)

# æ£€æŸ¥æ˜¯å¦åŒ…å«è¯¾é¢˜è¾…å¯¼
if lead.has_service_type('tutoring'):
    print("åŒ…å«è¯¾é¢˜è¾…å¯¼æœåŠ¡")

# æ£€æŸ¥æ˜¯å¦åŒ…å«ç«èµ›è¾…å¯¼
if lead.has_service_type('competition'):
    print("åŒ…å«ç«èµ›è¾…å¯¼æœåŠ¡")
```

---

### 2. ç«èµ›å¥–é¡¹ç­‰çº§ (competition_award_level)

#### å­˜å‚¨ä½ç½®
**è¡¨**: `leads` (çº¿ç´¢è¡¨) + `customers` (å®¢æˆ·è¡¨)
**å­—æ®µ**: `competition_award_level`
**ç±»å‹**: `VARCHAR(20)`

> âœ¨ **v2.0æ›´æ–°**: è¯¥å­—æ®µå·²æ¢å¤åˆ°çº¿ç´¢è¡¨ï¼Œé”€å”®å¯ä»¥åœ¨çº¿ç´¢é˜¶æ®µè®¾ç½®ï¼Œè½¬å®¢æˆ·æ—¶è‡ªåŠ¨å¤åˆ¶åˆ°å®¢æˆ·è¡¨ã€‚

#### å­˜å‚¨æ ¼å¼
**æ™®é€šå­—ç¬¦ä¸²**

#### å¯é€‰å€¼
| å€¼ | è¯´æ˜ |
|---|------|
| `None` æˆ– `NULL` | æ— å¥–é¡¹è¦æ±‚ |
| `"å¸‚å¥–"` | å¸‚çº§å¥–é¡¹ |
| `"å›½å¥–"` | å›½å®¶çº§å¥–é¡¹ |

#### å®é™…å­˜å‚¨ç¤ºä¾‹

**ç¤ºä¾‹1: æ— å¥–é¡¹è¦æ±‚**
```python
# æ•°æ®åº“å­˜å‚¨
competition_award_level = None

# è¯»å–
customer.competition_award_level  # None
```

**ç¤ºä¾‹2: å¸‚å¥–**
```python
# æ•°æ®åº“å­˜å‚¨
competition_award_level = 'å¸‚å¥–'

# è¯»å–
customer.competition_award_level  # 'å¸‚å¥–'
```

**ç¤ºä¾‹3: å›½å¥–**
```python
# æ•°æ®åº“å­˜å‚¨
competition_award_level = 'å›½å¥–'

# è¯»å–
customer.competition_award_level  # 'å›½å¥–'
```

#### è¯»å–æ–¹å¼

```python
customer = Customer.query.get(1)
award_level = customer.competition_award_level  # 'å›½å¥–' æˆ– 'å¸‚å¥–' æˆ– None
```

#### è®¾ç½®æ–¹å¼

```python
customer = Customer.query.get(1)

# è®¾ç½®ä¸ºå›½å¥–
customer.competition_award_level = 'å›½å¥–'

# è®¾ç½®ä¸ºå¸‚å¥–
customer.competition_award_level = 'å¸‚å¥–'

# è®¾ç½®ä¸ºæ— è¦æ±‚
customer.competition_award_level = None
```

---

### 3. é¢å¤–è¦æ±‚ (additional_requirements)

#### å­˜å‚¨ä½ç½®
**è¡¨**: `leads` (çº¿ç´¢è¡¨) + `customers` (å®¢æˆ·è¡¨)
**å­—æ®µ**: `additional_requirements`
**ç±»å‹**: `TEXT`

> âœ¨ **v2.0æ›´æ–°**: è¯¥å­—æ®µå·²æ¢å¤åˆ°çº¿ç´¢è¡¨ï¼Œé”€å”®å¯ä»¥åœ¨çº¿ç´¢é˜¶æ®µè®¾ç½®ï¼Œè½¬å®¢æˆ·æ—¶è‡ªåŠ¨å¤åˆ¶åˆ°å®¢æˆ·è¡¨ã€‚

#### å­˜å‚¨æ ¼å¼
**æ™®é€šæ–‡æœ¬å­—ç¬¦ä¸²**

#### å®é™…å­˜å‚¨ç¤ºä¾‹

**ç¤ºä¾‹1: æ— é¢å¤–è¦æ±‚**
```python
# æ•°æ®åº“å­˜å‚¨
additional_requirements = None

# è¯»å–
customer.additional_requirements  # None
```

**ç¤ºä¾‹2: æœ‰é¢å¤–è¦æ±‚**
```python
# æ•°æ®åº“å­˜å‚¨
additional_requirements = 'æµ‹è¯•é¢å¤–è¦æ±‚ï¼šéœ€è¦åœ¨2026å¹´5æœˆå‰å®Œæˆæ‰€æœ‰è¯¾ç¨‹å¹¶è·å¾—å›½å¥–'

# è¯»å–
customer.additional_requirements  # 'æµ‹è¯•é¢å¤–è¦æ±‚ï¼šéœ€è¦åœ¨2026å¹´5æœˆå‰å®Œæˆæ‰€æœ‰è¯¾ç¨‹å¹¶è·å¾—å›½å¥–'
```

**ç¤ºä¾‹3: å¤æ‚çš„é¢å¤–è¦æ±‚**
```python
# æ•°æ®åº“å­˜å‚¨
additional_requirements = 'æŒ‰æ—¶æŠ¥åèµ›å¯Œåˆ›æ™ºæ¯ï¼Œå¦åˆ™100%é€€æ¬¾'

# è¯»å–
customer.additional_requirements  # 'æŒ‰æ—¶æŠ¥åèµ›å¯Œåˆ›æ™ºæ¯ï¼Œå¦åˆ™100%é€€æ¬¾'
```

#### è¯»å–æ–¹å¼

```python
customer = Customer.query.get(1)
requirements = customer.additional_requirements  # å­—ç¬¦ä¸²æˆ–None
```

#### è®¾ç½®æ–¹å¼

```python
customer = Customer.query.get(1)

# è®¾ç½®é¢å¤–è¦æ±‚
customer.additional_requirements = 'éœ€è¦åœ¨2026å¹´5æœˆå‰å®Œæˆæ‰€æœ‰è¯¾ç¨‹'

# æ¸…ç©ºé¢å¤–è¦æ±‚
customer.additional_requirements = None
```

---

## ğŸ”„ æ•°æ®æµè½¬

### çº¿ç´¢é˜¶æ®µ â†’ å®¢æˆ·é˜¶æ®µ

```
çº¿ç´¢è¡¨ (leads)                    å®¢æˆ·è¡¨ (customers)
â”œâ”€ service_types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”œâ”€ lead_id (å…³è”)
â”œâ”€ sales_user_id             â”‚    â”œâ”€ teacher_user_id
â”œâ”€ stage                     â”‚    â”œâ”€ competition_award_level âœ¨ æ–°å¢
â”œâ”€ contract_amount           â”‚    â”œâ”€ additional_requirements âœ¨ æ–°å¢
â””â”€ ...                       â”‚    â””â”€ exam_year
                             â”‚
                             â””â”€â”€â†’ é€šè¿‡å…³è”å…³ç³»è¯»å–
```

### å­—æ®µåˆ†ç¦»é€»è¾‘

| å­—æ®µ | çº¿ç´¢é˜¶æ®µ | å®¢æˆ·é˜¶æ®µ | è¯´æ˜ |
|-----|---------|---------|------|
| **æœåŠ¡ç±»å‹** | âœ… å­˜å‚¨ | ğŸ”— å…³è”è¯»å– | åœ¨çº¿ç´¢è¡¨ï¼Œå®¢æˆ·é€šè¿‡å…³è”è¯»å– |
| **è´£ä»»é”€å”®** | âœ… å­˜å‚¨ | ğŸ”— å…³è”è¯»å– | åœ¨çº¿ç´¢è¡¨ï¼Œå®¢æˆ·é€šè¿‡å…³è”è¯»å– |
| **ç«èµ›ç­‰çº§** | âŒ ä¸å­˜å‚¨ | âœ… å­˜å‚¨ | åªåœ¨å®¢æˆ·è¡¨å­˜å‚¨ |
| **é¢å¤–è¦æ±‚** | âŒ ä¸å­˜å‚¨ | âœ… å­˜å‚¨ | åªåœ¨å®¢æˆ·è¡¨å­˜å‚¨ |

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹ï¼šåˆ›å»ºçº¿ç´¢å¹¶è½¬ä¸ºå®¢æˆ·

```python
from models import Lead, Customer, db
import json

# 1. åˆ›å»ºçº¿ç´¢
lead = Lead(
    student_name='å¼ ä¸‰',
    parent_wechat_display_name='å¼ ä¸‰å®¶é•¿',
    parent_wechat_name='zhangsan_parent',
    contact_info='13800138000',
    sales_user_id=1,
    stage='è·å–è”ç³»æ–¹å¼',
    service_types='["tutoring", "competition"]'  # JSONå­—ç¬¦ä¸²
)
db.session.add(lead)
db.session.commit()

# 2. è¯»å–æœåŠ¡ç±»å‹
services = lead.get_service_types_list()
print(services)  # ['tutoring', 'competition']

# 3. è½¬ä¸ºå®¢æˆ·
customer = Customer(
    lead_id=lead.id,
    teacher_user_id=2,
    payment_amount=20000,
    competition_award_level='å›½å¥–',  # æ™®é€šå­—ç¬¦ä¸²
    additional_requirements='éœ€è¦åœ¨2026å¹´5æœˆå‰å®Œæˆ',  # æ™®é€šæ–‡æœ¬
    exam_year=2026
)
db.session.add(customer)
db.session.commit()

# 4. ä»å®¢æˆ·è¯»å–æœåŠ¡ç±»å‹ï¼ˆé€šè¿‡å…³è”ï¼‰
customer_services = customer.get_service_types()
print(customer_services)  # ['tutoring', 'competition']

# 5. è¯»å–ç«èµ›ç­‰çº§å’Œé¢å¤–è¦æ±‚
print(customer.competition_award_level)  # 'å›½å¥–'
print(customer.additional_requirements)  # 'éœ€è¦åœ¨2026å¹´5æœˆå‰å®Œæˆ'
```

---

## ğŸ“ æ€»ç»“

### å­˜å‚¨æ–¹å¼å¯¹æ¯”

| å­—æ®µ | å­˜å‚¨ä½ç½® | æ•°æ®ç±»å‹ | å­˜å‚¨æ ¼å¼ | ç¤ºä¾‹ |
|-----|---------|---------|---------|------|
| **æœåŠ¡ç±»å‹** | leads.service_types | TEXT | JSONå­—ç¬¦ä¸²æ•°ç»„ | `'["tutoring", "competition"]'` |
| **ç«èµ›ç­‰çº§** | customers.competition_award_level | VARCHAR(20) | æ™®é€šå­—ç¬¦ä¸² | `'å›½å¥–'` æˆ– `'å¸‚å¥–'` æˆ– `None` |
| **é¢å¤–è¦æ±‚** | customers.additional_requirements | TEXT | æ™®é€šæ–‡æœ¬ | `'éœ€è¦åœ¨2026å¹´5æœˆå‰å®Œæˆ'` |

### å…³é”®è¦ç‚¹

1. âœ… **æœåŠ¡ç±»å‹ä½¿ç”¨JSONå­˜å‚¨**ï¼Œæ”¯æŒå¤šä¸ªæœåŠ¡ç±»å‹
2. âœ… **ç«èµ›ç­‰çº§å’Œé¢å¤–è¦æ±‚ä½¿ç”¨æ™®é€šå­—ç¬¦ä¸²**ï¼Œç®€å•ç›´æ¥
3. âœ… **æœåŠ¡ç±»å‹åœ¨çº¿ç´¢è¡¨**ï¼Œå®¢æˆ·é€šè¿‡å…³è”å…³ç³»è¯»å–
4. âœ… **ç«èµ›ç­‰çº§å’Œé¢å¤–è¦æ±‚åœ¨å®¢æˆ·è¡¨**ï¼Œåªåœ¨å®¢æˆ·é˜¶æ®µè®¾ç½®
5. âœ… **æä¾›äº†è¾…åŠ©æ–¹æ³•**ï¼Œç®€åŒ–JSONçš„è¯»å†™æ“ä½œ

---

**æ–‡æ¡£ç»“æŸ**

