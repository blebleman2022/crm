{% extends "admin/base.html" %}

{% block title %}添加用户 - EduConnect CRM{% endblock %}
{% block page_title %}添加用户{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900">添加新用户</h2>
        <p class="mt-2 text-gray-600">创建新的用户账号并分配相应的角色权限。</p>
    </div>

    <div class="bg-white shadow rounded-lg">
        <form method="POST" class="space-y-6 p-6">
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700">用户名</label>
                <div class="mt-1">
                    <input type="text" name="username" id="username" required
                           class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
                           placeholder="请输入用户名">
                </div>
                <p class="mt-2 text-sm text-gray-500">用户名将用于系统内部识别，建议使用真实姓名。</p>
            </div>

            <div>
                <label for="phone" class="block text-sm font-medium text-gray-700">手机号</label>
                <div class="mt-1">
                    <input type="tel" name="phone" id="phone" required
                           class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
                           placeholder="请输入11位手机号">
                </div>
                <p class="mt-2 text-sm text-gray-500">手机号将作为登录凭证，请确保号码正确。</p>
            </div>

            <div>
                <label for="role" class="block text-sm font-medium text-gray-700">用户角色</label>
                <div class="mt-1">
                    <select name="role" id="role" required
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                        <option value="">请选择角色</option>
                        <option value="admin">管理员</option>
                        <option value="sales_manager">销售管理</option>
                        <option value="salesperson">销售</option>
                        <option value="teacher_supervisor">班主任</option>
                    </select>
                </div>
                <p class="mt-2 text-sm text-gray-500">
                    <strong>管理员</strong>：系统全权限；
                    <strong>销售管理</strong>：线索和客户管理、付款管理、转客户；
                    <strong>销售</strong>：线索管理（仅自己负责的）；
                    <strong>班主任</strong>：服务交付管理、辅导老师管理
                </p>
            </div>

            <div>
                <label for="group_name" class="block text-sm font-medium text-gray-700">组别名称</label>
                <div class="mt-1">
                    <input type="text" name="group_name" id="group_name"
                           class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
                           placeholder="请输入组别名称（可选）">
                </div>
                <p class="mt-2 text-sm text-gray-500">用于组织内部管理，可以按部门或团队进行分组。</p>
            </div>

            <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                <a href="{{ url_for('admin.users') }}"
                   class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    取消
                </a>
                <button type="submit"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    创建用户
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// 手机号格式化
document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 11) {
        value = value.slice(0, 11);
    }
    e.target.value = value;
});

// 表单验证
document.querySelector('form').addEventListener('submit', function(e) {
    const phone = document.getElementById('phone').value;
    const phoneRegex = /^1[3-9]\d{9}$/;
    
    if (!phoneRegex.test(phone)) {
        e.preventDefault();
        alert('请输入正确的11位手机号');
        return false;
    }
});
</script>
{% endblock %}
