# 线索编辑页必填字段总结

**统计时间**: 2025-09-30  
**页面**: 线索编辑页面 (`templates/leads/edit.html`)

---

## 📋 必填字段列表

### 基本信息区域

| 字段 | 是否必填 | 标记 | 属性 | 说明 |
|-----|---------|------|------|------|
| **家长微信名** | ❌ 否 | 无 `*` | 无 `required` | 可选字段 |
| **家长微信号** | ✅ **是** | 有 `*` | 有 `required` | 必填字段 |
| **学员姓名** | ❌ 否 | 无 `*` | 无 `required` | 可选字段 |
| **联系电话** | ❌ 否 | 无 `*` | 无 `required` | 可选字段 |
| **线索来源** | ✅ **是** | 有 `*` | 有 `required` | 必填字段（未锁定时） |
| **责任销售** | ✅ **是** | 有 `*` | 有 `required` | 必填字段（未锁定时） |
| **年级** | ❌ 否 | 无 `*` | 无 `required` | 可选字段 |
| **行政区** | ❌ 否 | 无 `*` | 无 `required` | 可选字段 |
| **学校** | ❌ 否 | 无 `*` | 无 `required` | 可选字段 |

### 服务内容区域

| 字段 | 是否必填 | 标记 | 属性 | 说明 |
|-----|---------|------|------|------|
| **服务类型** | ✅ **是** | 有 `*` | JavaScript验证 | 至少选择一项 |
| **竞赛奖项等级** | ✅ **是** | 有 `*` | JavaScript验证 | 选择竞赛辅导时必填 |
| **额外要求** | ❌ 否 | 无 `*` | 无 `required` | 可选字段 |

### 付款记录区域（添加付款时）

| 字段 | 是否必填 | 标记 | 属性 | 说明 |
|-----|---------|------|------|------|
| **付款日期** | ✅ **是** | 有 `*` | 有 `required` | 添加付款时必填 |
| **付款金额** | ✅ **是** | 有 `*` | 有 `required` | 添加付款时必填 |

### 动态必填字段

| 字段 | 条件 | 说明 |
|-----|------|------|
| **自定义线索来源** | 线索来源选择"其他"时 | JavaScript动态设置 `required` |

---

## 📊 必填字段统计

### 总体统计

- **总字段数**: 约15个主要字段
- **必填字段数**: 6个（条件必填）
- **可选字段数**: 9个

### 按区域统计

| 区域 | 必填字段 | 可选字段 |
|-----|---------|---------|
| **基本信息** | 2个 | 7个 |
| **服务内容** | 2个 | 1个 |
| **付款记录** | 2个 | 0个 |

---

## 🔍 详细说明

### 1. 家长微信号 ✅ 必填

```html
<label>家长微信号 <span class="text-red-500">*</span></label>
<input name="parent_wechat_name" required>
```

**说明**：
- ✅ 始终必填
- ✅ 有红色 `*` 标记
- ✅ 有 `required` 属性
- ✅ 用于唯一标识线索

### 2. 线索来源 ✅ 必填（条件）

```html
<label>
    线索来源
    {% if not is_field_locked(lead.lead_source) %}<span class="text-red-500">*</span>{% endif %}
</label>
<select name="lead_source"
        {% if not is_field_locked(lead.lead_source) %}required{% endif %}>
```

**说明**：
- ✅ 未锁定时必填
- ✅ 锁定后不再必填
- ✅ 动态显示 `*` 标记

### 3. 责任销售 ✅ 必填（条件）

```html
<label>
    责任销售
    {% if not is_field_locked(lead.sales_user_id) %}<span class="text-red-500">*</span>{% endif %}
</label>
<select name="sales_user_id"
        {% if not is_field_locked(lead.sales_user_id) %}required{% endif %}>
```

**说明**：
- ✅ 未锁定时必填
- ✅ 锁定后不再必填
- ✅ 动态显示 `*` 标记

### 4. 服务类型 ✅ 必填

```html
<label>服务类型 <span class="text-red-500">*</span></label>
<!-- 复选框组 -->
```

**说明**：
- ✅ 始终必填
- ✅ 有红色 `*` 标记
- ✅ JavaScript验证至少选择一项

### 5. 竞赛奖项等级 ✅ 必填（条件）

```html
<label>
    竞赛奖项等级 <span class="text-red-500">*</span>
</label>
<select name="competition_award_level">
```

**说明**：
- ✅ 选择竞赛辅导时必填
- ✅ 有红色 `*` 标记
- ✅ JavaScript联动验证

### 6. 付款相关字段 ✅ 必填（添加付款时）

```html
<label>付款日期 <span class="text-red-500">*</span></label>
<input name="payment_date" required>

<label>付款金额 <span class="text-red-500">*</span></label>
<input name="payment_amount" required>
```

**说明**：
- ✅ 添加付款记录时必填
- ✅ 有红色 `*` 标记
- ✅ 有 `required` 属性

---

## 🎯 可选字段说明

### 基本信息中的可选字段

| 字段 | 说明 |
|-----|------|
| **家长微信名** | 显示名称，可选 |
| **学员姓名** | 可以后续补充 |
| **联系电话** | 可选，但建议填写 |
| **年级** | 可选，用于计算中高考年份 |
| **行政区** | 可选，用于地域分析 |
| **学校** | 可选，用于学校统计 |

### 服务内容中的可选字段

| 字段 | 说明 |
|-----|------|
| **额外要求** | 可选，特殊需求时填写 |

---

## 🔒 锁定机制对必填的影响

### 锁定后的变化

当字段被锁定后：
- ❌ 不再显示红色 `*` 标记
- ❌ 移除 `required` 属性
- ✅ 显示"(已锁定，无法修改)"
- ✅ 字段变为只读状态

### 示例：线索来源

**未锁定时**：
```
线索来源 *
┌─────────────────┐
│ 请选择线索来源  │  ← 必填
└─────────────────┘
```

**锁定后**：
```
线索来源 (已锁定，无法修改)
┌─────────────────┐
│ 周cc           │  ← 不再必填
└─────────────────┘
```

---

## 📝 表单验证逻辑

### HTML5验证

- ✅ `required` 属性自动验证
- ✅ 浏览器原生提示
- ✅ 阻止表单提交

### JavaScript验证

1. **服务类型验证**：
   ```javascript
   // 至少选择一项服务类型
   if (selectedServices.length === 0) {
       alert('请至少选择一种服务类型！');
       return false;
   }
   ```

2. **竞赛奖项联动验证**：
   ```javascript
   // 选择竞赛辅导时必须设置奖项等级
   if (competitionChecked && !awardLevel) {
       alert('选择了竞赛辅导服务，必须设置目标奖项等级！');
       return false;
   }
   ```

3. **自定义线索来源验证**：
   ```javascript
   // 选择"其他"时动态设置必填
   if (sourceSelect.value === '其他') {
       customSourceInput.required = true;
   }
   ```

---

## 🎉 总结

### 核心必填字段（始终必填）

1. ✅ **家长微信号** - 唯一标识
2. ✅ **服务类型** - 业务核心

### 条件必填字段

1. ✅ **线索来源** - 未锁定时必填
2. ✅ **责任销售** - 未锁定时必填
3. ✅ **竞赛奖项等级** - 选择竞赛辅导时必填
4. ✅ **付款日期/金额** - 添加付款时必填

### 可选字段

- ✅ 大部分基本信息字段
- ✅ 额外要求等补充信息

### 设计原则

- ✅ **最小必填** - 只要求核心必要信息
- ✅ **渐进完善** - 可以后续补充详细信息
- ✅ **智能验证** - 根据选择动态调整必填要求
- ✅ **锁定保护** - 重要信息首次填写后锁定

---

**统计完成！** 🎉

线索编辑页面共有 **6个必填字段**（包括条件必填），其余均为可选字段，设计合理，符合业务需求。
