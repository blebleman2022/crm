# æ•°æ®åº“ç®¡ç†è¯´æ˜

## ğŸ“‹ æ•°æ®åº“æ–‡ä»¶ä½ç½®

### æœ¬åœ°å¼€å‘ç¯å¢ƒ
```
instance/edu_crm.db
```

### Dockerå®¹å™¨ç¯å¢ƒ
```
/app/instance/edu_crm.db
```

---

## âš ï¸ é‡è¦è¯´æ˜

### æ•°æ®åº“æ–‡ä»¶å·²ä»Gitç‰ˆæœ¬æ§åˆ¶ä¸­ç§»é™¤

ä»æœ¬æ¬¡æäº¤å¼€å§‹ï¼Œæ•°æ®åº“æ–‡ä»¶ `instance/edu_crm.db` å·²è¢«æ·»åŠ åˆ° `.gitignore`ï¼Œä¸å†è¢«Gitè¿½è¸ªã€‚

**åŸå› **ï¼š
1. âœ… æ•°æ®åº“æ–‡ä»¶åŒ…å«ç”¨æˆ·æ•°æ®ï¼Œä¸åº”è¯¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
2. âœ… æ¯ä¸ªç¯å¢ƒåº”è¯¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“
3. âœ… é¿å…ä¸åŒå¼€å‘è€…ä¹‹é—´çš„æ•°æ®å†²çª
4. âœ… å‡å°Gitä»“åº“å¤§å°

---

## ğŸ”„ é¦–æ¬¡éƒ¨ç½²/å…‹éš†é¡¹ç›®

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

å…‹éš†é¡¹ç›®åï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ›å»ºï¼š

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://gitee.com/blebleman/crm.git
cd crm

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. å¯åŠ¨åº”ç”¨ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼‰
python run.py
```

**é¦–æ¬¡å¯åŠ¨æ—¶**ï¼š
- âœ… è‡ªåŠ¨åˆ›å»º `instance/edu_crm.db`
- âœ… è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰æ•°æ®è¡¨
- âœ… è‡ªåŠ¨åˆå§‹åŒ–æµ‹è¯•è´¦å·

### Dockerç¯å¢ƒ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://gitee.com/blebleman/crm.git
cd crm

# 2. åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p instance logs

# 3. å¯åŠ¨Dockerå®¹å™¨ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼‰
docker compose up -d
```

---

## ğŸ’¾ æ•°æ®åº“å¤‡ä»½

### æ‰‹åŠ¨å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
cp instance/edu_crm.db instance/edu_crm_backup_$(date +%Y%m%d_%H%M%S).db

# æˆ–ä½¿ç”¨Pythonè„šæœ¬
python -c "
import shutil
from datetime import datetime
timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
shutil.copy('instance/edu_crm.db', f'instance/edu_crm_backup_{timestamp}.db')
print(f'å¤‡ä»½å®Œæˆ: edu_crm_backup_{timestamp}.db')
"
```

### è‡ªåŠ¨å¤‡ä»½ï¼ˆæ¨èï¼‰

åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * cd /root/crm && cp instance/edu_crm.db instance/edu_crm_backup_$(date +\%Y\%m\%d).db

# æ·»åŠ æ¯å‘¨æ—¥æ¸…ç†30å¤©å‰çš„å¤‡ä»½
0 3 * * 0 find /root/crm/instance -name "edu_crm_backup_*.db" -mtime +30 -delete
```

---

## ğŸ”„ æ•°æ®åº“æ¢å¤

### ä»å¤‡ä»½æ¢å¤

```bash
# 1. åœæ­¢åº”ç”¨
# æœ¬åœ°: Ctrl+C
# Docker: docker compose down

# 2. æ¢å¤æ•°æ®åº“
cp instance/edu_crm_backup_20250102.db instance/edu_crm.db

# 3. é‡å¯åº”ç”¨
# æœ¬åœ°: python run.py
# Docker: docker compose up -d
```

---

## ğŸš€ ç¯å¢ƒè¿ç§»

### ä»å¼€å‘ç¯å¢ƒè¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. åœ¨å¼€å‘ç¯å¢ƒå¤‡ä»½æ•°æ®åº“
cp instance/edu_crm.db edu_crm_export.db

# 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp edu_crm_export.db root@your-server:/root/crm/instance/edu_crm.db

# 3. åœ¨æœåŠ¡å™¨ä¸Šé‡å¯æœåŠ¡
cd /root/crm
docker compose restart
```

### ä»ç”Ÿäº§ç¯å¢ƒåŒæ­¥åˆ°å¼€å‘ç¯å¢ƒ

```bash
# 1. ä»æœåŠ¡å™¨ä¸‹è½½æ•°æ®åº“
scp root@your-server:/root/crm/instance/edu_crm.db instance/edu_crm_prod.db

# 2. å¤‡ä»½æœ¬åœ°æ•°æ®åº“
cp instance/edu_crm.db instance/edu_crm_local_backup.db

# 3. ä½¿ç”¨ç”Ÿäº§æ•°æ®åº“
cp instance/edu_crm_prod.db instance/edu_crm.db

# 4. é‡å¯æœ¬åœ°æœåŠ¡
python run.py
```

---

## ğŸ“Š æ•°æ®åº“ç»´æŠ¤

### æŸ¥çœ‹æ•°æ®åº“ä¿¡æ¯

```bash
# ä½¿ç”¨SQLiteå‘½ä»¤è¡Œå·¥å…·
sqlite3 instance/edu_crm.db

# æŸ¥çœ‹æ‰€æœ‰è¡¨
.tables

# æŸ¥çœ‹è¡¨ç»“æ„
.schema leads

# æŸ¥çœ‹æ•°æ®
SELECT * FROM users;

# é€€å‡º
.quit
```

### æ•°æ®åº“ä¼˜åŒ–

```bash
# å‹ç¼©æ•°æ®åº“ï¼ˆå‡å°æ–‡ä»¶å¤§å°ï¼‰
sqlite3 instance/edu_crm.db "VACUUM;"

# åˆ†ææ•°æ®åº“ï¼ˆä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼‰
sqlite3 instance/edu_crm.db "ANALYZE;"
```

---

## ğŸ”’ æ•°æ®å®‰å…¨

### æƒé™è®¾ç½®

```bash
# è®¾ç½®æ•°æ®åº“æ–‡ä»¶æƒé™ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
chmod 600 instance/edu_crm.db

# è®¾ç½®instanceç›®å½•æƒé™
chmod 700 instance/
```

### åŠ å¯†å¤‡ä»½ï¼ˆå¯é€‰ï¼‰

```bash
# ä½¿ç”¨GPGåŠ å¯†å¤‡ä»½
gpg -c instance/edu_crm_backup_20250102.db

# è§£å¯†
gpg instance/edu_crm_backup_20250102.db.gpg
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä¸è¦æäº¤æ•°æ®åº“æ–‡ä»¶åˆ°Git

æ•°æ®åº“æ–‡ä»¶å·²åœ¨ `.gitignore` ä¸­ï¼ŒGitä¼šè‡ªåŠ¨å¿½ç•¥ã€‚

**éªŒè¯**ï¼š
```bash
git status
# ä¸åº”è¯¥çœ‹åˆ° instance/edu_crm.db
```

### 2. å®šæœŸå¤‡ä»½

- âœ… ç”Ÿäº§ç¯å¢ƒï¼šæ¯å¤©è‡ªåŠ¨å¤‡ä»½
- âœ… å¼€å‘ç¯å¢ƒï¼šé‡è¦ä¿®æ”¹å‰æ‰‹åŠ¨å¤‡ä»½
- âœ… ä¿ç•™è‡³å°‘7å¤©çš„å¤‡ä»½

### 3. æµ‹è¯•ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“

ä¸è¦åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨ç”Ÿäº§æ•°æ®åº“ï¼Œé¿å…è¯¯æ“ä½œã€‚

### 4. æ•°æ®åº“è¿ç§»

å¦‚æœä¿®æ”¹äº†æ•°æ®æ¨¡å‹ï¼ˆmodels.pyï¼‰ï¼Œéœ€è¦ï¼š
1. å¤‡ä»½ç°æœ‰æ•°æ®åº“
2. æµ‹è¯•è¿ç§»è„šæœ¬
3. åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œè¿ç§»

---

## ğŸ“ .gitignore é…ç½®

å½“å‰é…ç½®ï¼ˆå·²ç”Ÿæ•ˆï¼‰ï¼š

```gitignore
# Database (å¿½ç•¥æ‰€æœ‰æ•°æ®åº“æ–‡ä»¶)
instance/*.db
*_backup_*.db
*.sqlite
*.sqlite3
*.db
```

è¿™ç¡®ä¿äº†ï¼š
- âœ… æ‰€æœ‰ `.db` æ–‡ä»¶éƒ½è¢«å¿½ç•¥
- âœ… æ‰€æœ‰å¤‡ä»½æ–‡ä»¶éƒ½è¢«å¿½ç•¥
- âœ… SQLiteæ•°æ®åº“æ–‡ä»¶éƒ½è¢«å¿½ç•¥

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: å…‹éš†é¡¹ç›®åæ²¡æœ‰æ•°æ®åº“æ€ä¹ˆåŠï¼Ÿ

**A**: æ­£å¸¸ç°è±¡ã€‚é¦–æ¬¡è¿è¡Œ `python run.py` æˆ– `docker compose up` æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºã€‚

### Q2: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ

**A**: 
```bash
# åˆ é™¤æ•°æ®åº“æ–‡ä»¶
rm instance/edu_crm.db

# é‡å¯åº”ç”¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°æ•°æ®åº“
python run.py
```

### Q3: æ•°æ®åº“æ–‡ä»¶å¾ˆå¤§æ€ä¹ˆåŠï¼Ÿ

**A**: 
```bash
# å‹ç¼©æ•°æ®åº“
sqlite3 instance/edu_crm.db "VACUUM;"

# æ¸…ç†æ—§æ•°æ®ï¼ˆè°¨æ…æ“ä½œï¼‰
# ä¾‹å¦‚ï¼šåˆ é™¤6ä¸ªæœˆå‰çš„æ—¥å¿—
```

### Q4: å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒæ•°æ®åº“ï¼Ÿ

**A**: 
é€šè¿‡ç¯å¢ƒå˜é‡ `DATABASE_URL` é…ç½®ï¼š

```bash
# å¼€å‘ç¯å¢ƒ
export DATABASE_URL=sqlite:///instance/edu_crm_dev.db

# æµ‹è¯•ç¯å¢ƒ
export DATABASE_URL=sqlite:///instance/edu_crm_test.db

# ç”Ÿäº§ç¯å¢ƒ
export DATABASE_URL=sqlite:///instance/edu_crm.db
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“ç»“æ„è¯´æ˜.md](æ•°æ®åº“ç»“æ„è¯´æ˜.md) - æ•°æ®è¡¨ç»“æ„è¯¦ç»†è¯´æ˜
- [CONFIG.md](CONFIG.md) - é…ç½®æ–‡ä»¶è¯´æ˜
- [README.md](README.md) - é¡¹ç›®æ€»ä½“è¯´æ˜

---

**æœ€åæ›´æ–°**: 2025-01-02  
**ç‰ˆæœ¬**: 1.0

